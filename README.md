# TIFF切片工具用户手册

## 1. 软件概述

TIFF切片工具是一款专为地理信息系统(GIS)数据处理设计的应用程序，主要用于将大型TIFF地理影像文件按照指定的单元大小进行切割，生成统一尺寸的图像切片。该工具支持地理坐标对齐和GeoJSON区域限定功能，可以有效地处理多个TIFF文件，并保持它们之间的地理参考一致性。

### 主要功能

- 批量处理多个TIFF文件
- 按指定米数大小进行切片
- 自动读取TFW文件获取地理参考信息
- 支持多TIFF文件的坐标对齐
- 支持使用GeoJSON文件限定处理区域
- 图形用户界面，操作简便
- 实时处理日志显示
- 处理进度可视化

## 2. 安装说明

### 2.1 系统要求

- 操作系统：Windows 7/8/10/11
- Python 3.6 或更高版本
- 足够的磁盘空间用于存储输出的切片文件

### 2.2 依赖库

本工具依赖以下Python库：

- PyQt5：用于图形用户界面
- numpy：用于数组处理
- rasterio：用于读取和处理地理栅格数据
- PIL (Pillow)：用于图像处理
- shapely：用于地理空间数据处理

### 2.3 安装步骤

1. 确保已安装Python 3.6或更高版本
2. 使用pip安装所需依赖库：

```bash
pip install PyQt5 numpy rasterio Pillow shapely
```

3. 下载TIFF切片工具程序文件（tiff_splitter.py和tiff_splitter_gui.py）
4. 将程序文件放置在您选择的目录中

## 3. 界面介绍

![TIFF切片工具界面](界面示意图.png)

TIFF切片工具的图形界面包含以下主要部分：

### 3.1 参数设置区域

- **输入目录**：包含待处理TIFF文件的文件夹路径
- **输出目录**：处理结果将保存的文件夹路径
- **GeoJSON文件**：可选，用于限定处理区域的GeoJSON文件路径
- **切片单元大小**：设置切片的大小（以米为单位）

### 3.2 控制按钮

- **开始处理**：启动TIFF文件处理
- **停止处理**：中断当前处理过程

### 3.3 状态显示

- **处理进度**：显示当前处理进度的进度条
- **处理日志**：显示处理过程中的详细信息和状态

## 4. 使用说明

### 4.1 基本操作流程

1. 启动程序：运行tiff_splitter_gui.py文件
2. 设置参数：选择输入目录、输出目录，设置切片单元大小
3. 可选：选择GeoJSON文件以限定处理区域
4. 点击"开始处理"按钮开始处理
5. 查看处理日志和进度条了解处理状态
6. 处理完成后，在输出目录中查看结果

### 4.2 详细操作步骤

#### 4.2.1 选择输入目录

1. 点击"输入目录"右侧的"浏览..."按钮
2. 在弹出的文件夹选择对话框中，导航并选择包含TIFF文件的文件夹
3. 点击"选择文件夹"确认选择

> **注意**：输入目录必须包含至少一个.tif文件和对应的.tfw文件

#### 4.2.2 选择输出目录

1. 点击"输出目录"右侧的"浏览..."按钮
2. 在弹出的文件夹选择对话框中，导航并选择或创建用于保存结果的文件夹
3. 点击"选择文件夹"确认选择

#### 4.2.3 选择GeoJSON文件（可选）

1. 点击"GeoJSON文件"右侧的"浏览..."按钮
2. 在弹出的文件选择对话框中，导航并选择GeoJSON格式的区域限定文件
3. 点击"打开"确认选择

> **说明**：GeoJSON文件用于限定处理区域，只有与GeoJSON中定义的多边形相交的区域才会被处理。如果不选择GeoJSON文件，则处理整个TIFF影像。

#### 4.2.4 设置切片单元大小

1. 在"切片单元大小(米)"输入框中设置所需的切片大小
2. 可以直接输入数值，或使用上下箭头调整数值

> **建议**：根据您的应用需求选择合适的切片大小。较小的切片大小会生成更多的文件，但每个文件的精度更高；较大的切片大小会减少文件数量，但可能降低精度。

#### 4.2.5 开始处理

1. 确认所有参数设置正确后，点击"开始处理"按钮
2. 程序将开始处理TIFF文件，并在日志区域显示处理信息
3. 进度条将显示当前处理进度

#### 4.2.6 查看处理结果

1. 处理完成后，程序会弹出提示框通知处理完成
2. 在输出目录中，每个TIFF文件会生成一个对应的子文件夹，包含切片结果
3. 切片文件以PNG格式保存，文件名为切片左上角的地理坐标值

## 5. 参数详解

### 5.1 输入目录

输入目录应包含待处理的TIFF文件(.tif)及其对应的世界文件(.tfw)。世界文件包含地理参考信息，是处理过程必需的。

### 5.2 输出目录

程序将在输出目录中为每个处理的TIFF文件创建一个子文件夹，子文件夹名称与TIFF文件名相同（不含扩展名）。所有切片文件将保存在对应的子文件夹中。

### 5.3 GeoJSON文件

GeoJSON文件用于限定处理区域，只有与GeoJSON中定义的多边形相交的区域才会被处理。这对于只需处理特定区域（如行政边界内）的情况非常有用。

### 5.4 切片单元大小

切片单元大小定义了每个输出切片的地理尺寸（以米为单位）。例如，设置为256表示每个切片覆盖256米×256米的地理区域。所有输出的切片图像将被调整为1024×1024像素的大小。

## 6. 技术细节

### 6.1 坐标对齐

程序使用第一个TIFF文件的左上角坐标作为参考，其他TIFF文件会自动调整坐标以与参考坐标对齐。这确保了多个TIFF文件处理后的切片能够无缝拼接。

### 6.2 TFW文件格式

TFW文件是TIFF世界文件，包含以下地理参考信息：
- 行1：x方向像素分辨率（像素宽度）
- 行2：行旋转项（通常为0）
- 行3：列旋转项（通常为0）
- 行4：y方向像素分辨率（像素高度，通常为负值）
- 行5：左上角x坐标
- 行6：左上角y坐标

### 6.3 输出文件命名

输出的切片文件以PNG格式保存，文件名格式为：`{左上角X坐标}_{左上角Y坐标}.png`

## 7. 常见问题解答

### 7.1 程序报错"找不到对应的TFW文件"

**问题**：启动处理后，程序报错找不到TFW文件。

**解决方案**：确保每个TIFF文件(.tif)在同一目录下有对应的世界文件(.tfw)，且文件名相同（仅扩展名不同）。

### 7.2 处理速度很慢

**问题**：处理大型TIFF文件时速度很慢。

**解决方案**：
- 考虑增加切片单元大小，减少生成的切片数量
- 使用GeoJSON文件限定只处理需要的区域
- 确保计算机有足够的内存和处理能力

### 7.3 输出的切片图像质量不佳

**问题**：生成的切片图像模糊或质量不佳。

**解决方案**：
- 减小切片单元大小，增加每个地理区域的像素密度
- 检查原始TIFF文件的分辨率是否足够高

### 7.4 GeoJSON文件无法正确限定区域

**问题**：使用GeoJSON文件后，处理结果与预期不符。

**解决方案**：
- 确认GeoJSON文件的坐标系统与TIFF文件一致
- 检查GeoJSON文件格式是否正确，特别是多边形的定义方式
- 查看处理日志，了解多边形加载和相交判断的详细信息

## 8. 联系与支持

如果您在使用过程中遇到任何问题，或有功能改进建议，请联系开发团队：

- 邮箱：support@example.com
- 项目主页：https://github.com/example/tiff-splitter

---

© 2024 TIFF切片工具团队。保留所有权利。